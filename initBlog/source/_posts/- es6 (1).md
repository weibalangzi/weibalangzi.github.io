---
title: ES6--Map和WeakMap
tags:
- es6
---
>Map和WeakMap是es6新增的数据结构，它们本质与对象一样，都是键值对的集合
>但是他们与Object对象主要的不同是，键可以是各种类型的数值
>而Object对象的键只能是字符串类型或者Symbol类型值；

### Object数据结构
```javaScript
let obj = {};
let test = {};
obj[test] = "say hi";
obj["say"] = "say hello";
console.log(obj)//{[object Object]: "say hi", say: "say hello"}
```
<!--more-->
如上，当字符串“say”作为Object的键的时候，可以看到正常的键值对，但是当把对象test当做键的时候，该键被转换为字符串`[object Object]`，注意，这里的o一个为大写，一个为小写;
### Map数据结构
```javaScript
let obj = new Map();
let test = {};

obj.set(test, "hi");
console.log(obj);//Map(1) {{…} => "hi"}
console.log(obj.get(test));//hi
```
如上，和Object数据结构里的一样，同样是`console.log(obj)`但是并没有出现`[object Object]`，而是直接显示所定义的对象；

由于Map对象的键可以是对象，所以只有对同一个对象的引用，Map对象才将其视为同一个键；
```javaScript
let test = new Map();
test.set(["say"], "hello")
console.log(test.get(["say"]));//undefined
```
如上，尽管两个`["say"]`看起来是一样的，但是两者在内存中的地址并不相同；

而如果将以上代码修改一下：
```javaScript
let test = new Map();
let hehe = ["say"]
test.set(hehe, "hello")
console.log(test.get(hehe)); //hello
```
Map结构具有遍历器接口，所以可以使用展开运算符和for of循环遍历；
```javaScript
let test = new Map([
    ["say", "hi"],
    ["talk", "hello"]
]);
let arr = [...test];
console.log(arr);//(2) [Array(2), Array(2)]
```
### WeakMap数据结构
WeakMap结构与Map结构基本相似，但是WeakMap只接受对象作为键名，不接受其他类型的值作为键名，而且键名所指向的对象不计入垃圾回收机制；
```javaScript
let test = new Map();
test.set("say", "hi");
console.log(test); //Map(1) {"say" => "hi"}

let test2 = new WeakMap();
test2.set("say", "hi");//error
console.log(test2);

let test2 = new WeakMap();
test2.set({ say: "" }, "hi");
console.log(test2);//WeakMap {{…} => "hi"}
```
WeakMap是弱引用，所以垃圾回收机制不将该引用考虑在内，其所对应的对象可能会被自动回收，对象呗回收后，WeakMap自动移除对应的键值对，WeakMap结构有助于防止内存泄漏；

另外，WeakMap无法遍历，因为并没有遍历器接口；





